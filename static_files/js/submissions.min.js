_.each(["Model","Collection"],function(a){var b=Backbone[a],c=b.prototype.fetch;b.prototype.fetch=function(){return this.trigger("fetch",this),c.apply(this,arguments)}}),Backbone.View.prototype.close=function(){this.remove(),this.unbind(),this.onClose&&this.onClose()},_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g};var App=App||{};App.Options={sort_attribute:"-created_at",resizeColumns:!1,showColumns:!0,minimumCountColumns:2,columns:{}},App.set=function(a,b){"undefined"==typeof Storage?$.cookie(a,JSON.stringify(b),{expires:365}):localStorage.setItem(a,JSON.stringify(b))},App.get=function(a){if(!_.isNull(localStorage.getItem(a)))return JSON.parse(localStorage.getItem(a));return _.isUndefined($.cookie(a))?{}:JSON.parse($.cookie(a))},App.remove=function(a){localStorage.removeItem(a),$.cookie(a,null)},App.SubmissionsView=Backbone.View.extend({className:"submissions",subViews:{},template:_.template($("#submissionsTemplate").html()),initialize:function(){this.listenTo(this.collection,"fetch",this.showProgress),this.listenTo(this.collection,"sync",this.onSync)},events:{"keyup input.searchTxt":function(a){return a.preventDefault(),13==a.keyCode&&this.collection.searchPage(a.currentTarget.value),!1},"click button#refreshBtn":function(a){a.preventDefault(),App.remove("form_"+options.formID+"_options"),location.reload()},"click button.searchBtn":function(a){return a.preventDefault(),this.collection.searchPage($("input.searchTxt").val()),!1},"click a#filter-link":function(a){return a.preventDefault(),this.collection.filterPage($(a.currentTarget).attr("data-start"),$(a.currentTarget).attr("data-end")),!1},"click input.column":function(a){a.stopImmediatePropagation();var b=this.$(a.currentTarget),c=b.val();this.$("tr.submission div:nth-child("+c+"),th:nth-child("+c+")").toggle();var d=b.data("key");App.Options.columns[d]=b.is(":checked"),App.set("form_"+options.formID+"_options",App.Options),this.checkMinimumCountColumns()},"click button.resizeColumns":function(a){return a.preventDefault(),this.$("button.resizeColumns").toggle(),this.$("table.table").toggleClass("table-fullsize"),App.Options.resizeColumns=!App.Options.resizeColumns,App.set("form_"+options.formID+"_options",App.Options),!1},"click input#allRows":function(a){a.stopImmediatePropagation();var b=!this.$("input.row").prop("checked");this.$("input.row").prop("checked",b)},"click a#markAsRead":function(a){a.preventDefault();var b=[],c=this.$("input.row:checked");_.map(c,function(d){b.push($(d).data("id"))}),0<b.length&&this.collection.updateModelsByIds(b,{"new":0})},"click a#markAsUnread":function(a){a.preventDefault();var b=[],c=this.$("input.row:checked");_.map(c,function(d){b.push($(d).data("id"))}),0<b.length&&this.collection.updateModelsByIds(b,{"new":1})},"click a#deleteSelectedRows":function(a){a.preventDefault();var b=[],c=this.$("input.row:checked");_.map(c,function(d){b.push($(d).data("id"))}),0<b.length&&confirm(options.i18n.areYouSureDeleteItems)&&this.collection.destroyModelsByIds(b)},"click a#submitted_at":function(a){a.preventDefault();var b="-created_at"==this.collection.sort_attribute?"created_at":"-created_at";return this.collection.sortPage(b),!1}},onSync:function(a){_.isObject(a.models)&&this.render()},addSubview:function(a){a.get("data")?(this.subViews[a.cid]=new App.SubmissionView({model:a}),this.$("tbody").append(this.subViews[a.cid].render().el)):this.collection.destroyModelsByIds([a.get("id")])},showProgress:function(){this.$("#loading").show()},hideProgress:function(){this.$("#loading").hide()},closeSubviews:function(){_.invoke(this.subViews,"close")},onClose:function(){this.closeSubviews(),this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},checkMinimumCountColumns:function(){this.$("input.column:checked").length<=App.Options.minimumCountColumns?this.$("input.column:checked").prop("disabled",!0):this.$("input.column:checked").prop("disabled",!1)},toggleColumns:function(){if(App.Options.showColumns){var a=this,b=_.map(options.fields,function(d){return d.name}),c=App.Options.columns;_.isEmpty(c)||_.keys(c).length<b.length?_.each(b,function(d){c[d]=!0}):(_.each(b,function(d){var e=a.$("input[data-key=\""+d+"\"]"),f=e.val(),g=c[d];g?e.prop("checked",g):(a.$("tr.submission div:nth-child("+f+"),th:nth-child("+f+")").hide(),e.prop("checked",g))}),this.checkMinimumCountColumns())}else this.$("input.column:checked").prop("disabled",!0)},resizeColumns:function(){App.Options.resizeColumns&&(this.$("button.resizeColumns").eq(0).hide(),this.$("button.resizeColumns").eq(1).show(),this.$("table.table").toggleClass("table-fullsize"))},initDatePicker:function(){function a(g,h){b.$("#date-range").text(g.format(c)+" - "+h.format(c)),b.$("#filter-link").attr("data-start",g.format(c)),b.$("#filter-link").attr("data-end",h.format(c));var j=$.param({start:g.format(c),end:h.format(c)});b.$("#csv-link").attr("href",options.csvEndPoint+"&"+j),b.$("#xlsx-link").attr("href",options.xlsxEndPoint+"&"+j)}var b=this,c=options.dateFormat,d=this.collection.startDate,e=this.collection.endDate;_.isEmpty(d)||_.isEmpty(e)?(d=moment().subtract(29,"days"),e=moment()):(d=moment(d,c),e=moment(e,c));var f=[];f[options.i18n.today]=[moment(),moment()],f[options.i18n.yesterday]=[moment().subtract(1,"days"),moment().subtract(1,"days")],f[options.i18n.last7Days]=[moment().subtract(6,"days"),moment()],f[options.i18n.last30Days]=[moment().subtract(29,"days"),moment()],f[options.i18n.thisMonth]=[moment().startOf("month"),moment().endOf("month")],f[options.i18n.lastMonth]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],this.$("#range").daterangepicker({startDate:d,endDate:e,locale:{customRangeLabel:options.i18n.customRange,applyLabel:options.i18n.apply,cancelLabel:options.i18n.clear},language:options.language,ranges:f},a),this.$("#range").on("cancel.daterangepicker",function(){b.$("#date-range").text(""),b.$("#csv-link").attr("href",options.csvEndPoint),b.$("#xlsx-link").attr("href",options.xlsxEndPoint)}),a(d,e)},render:function(){return this.closeSubviews(),this.hideProgress(),this.el.innerHTML=this.template(this.collection.getPage()),this.$("input.searchTxt").val(this.collection.keywords),this.collection.each(this.addSubview.bind(this)),this.subViews.paginationView=new App.PaginationView({collection:this.collection}),this.$("#pagination").append(this.subViews.paginationView.render().el),this.toggleColumns(),this.resizeColumns(),this.initDatePicker(),this}}),App.SubmissionView=Backbone.View.extend({template:_.template($("#submissionTemplate").html()),tagName:"tr",className:"submission",events:{"click .view":"viewModel","click .edit":"editModel","click .remove":"removeModel"},viewModel:function(a){a.preventDefault(),App.Router.navigate("view/"+this.model.id,{trigger:!0})},editModel:function(a){a.preventDefault(),App.Router.navigate("edit/"+this.model.id,{trigger:!0})},removeModel:function(a){return a.preventDefault(),confirm(options.i18n.areYouSureDeleteItem)&&this.model.destroy({wait:!0}),!1},onClose:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},render:function(){var a=this.model.get("id"),b=this.model.get("new"),c=this.model.get("submitted"),d=this.model.get("data");_.isObject(d)||(d=JSON.parse(d)),this.el.innerHTML=this.template({id:a,isNew:b,data:d,created_at:c});var e=this;return e.$("td[data-key*=\"selectlist\"], td[data-key*=\"checkbox\"]").each(function(f,g){e.$(g).text(function(h,j){return j.replace(/,/g,", ")})}),this}}),App.DetailView=Backbone.View.extend({tagName:"div",className:"detailView",template:_.template($("#detailTemplate").html()),initialize:function(a){if(_.isObject(this.model))this.modelExists=!0;else{var b=this;this.model=new Submission,this.model.id=a.id,this.model.url=function(){return options.hasPrettyUrls?options.endPoint+"/"+a.id:options.deleteEndPoint+"&id="+a.id},this.model.fetch({success:function(){b.modelExists=!0,b.render()}})}},events:{"click .edit":"editModel","click .remove":"removeModel","click .removeFile":"removeFileModel","click #addComment":"addCommentModel","click .deleteComment":"deleteCommentModel","click #showEmptyFields":"showEmptyFields"},editModel:function(a){a.preventDefault(),App.Router.navigate("edit/"+this.model.id,{trigger:!0})},removeModel:function(a){return a.preventDefault(),confirm(options.i18n.areYouSureDeleteItem)&&this.model.destroy({wait:!0,success:function(){App.Router.navigate("",{trigger:!0})}}),!1},removeFileModel:function(a){if(a.preventDefault(),confirm(options.i18n.areYouSureDeleteFileItem)){var b=$(a.currentTarget).data("id"),c=this;$.ajax({url:options.deleteFileEndPoint,type:"POST",data:{submission_id:this.model.get("id"),file_id:b}}).done(function(d){d.success?($("tr[data-file='"+d.fileID+"']").remove(),c.model.fetch()):alert(options.i18n.errorOnDelete)}).fail(function(){alert(options.i18n.errorOnDelete)})}return!1},addCommentModel:function(a){a.preventDefault();var b=this;$.ajax({url:options.addCommentEndPoint,type:"POST",data:{submission_id:this.model.get("id"),comment:$("#commentContent").val()}}).done(function(c){if(c.id){var d=b.model.get("comments");d.push(c);var e=_.uniq(d,function(f){return f.id});b.model.set("comments",e),b.render()}else alert(options.i18n.errorOnUpdate)}).fail(function(){alert(options.i18n.errorOnUpdate)})},deleteCommentModel:function(a){a.preventDefault();var b=this;if(confirm(options.i18n.areYouSureDeleteCommentItem)){var c=$(a.currentTarget).data("id");$.ajax({url:options.deleteCommentEndPoint,type:"POST",data:{submission_id:b.model.get("id"),comment_id:c}}).done(function(d){if(d.success){$("li[data-comment-id='"+d.commentID+"']").remove();var e=b.model.get("comments"),f=_.reject(e,function(g){return g.id==d.commentID});b.model.set("comments",f),b.render()}else alert(options.i18n.errorOnDelete)}).fail(function(){alert(options.i18n.errorOnDelete)})}return!1},showEmptyFields:function(){this.render()},onClose:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},afterAppend:function(){if(_.isObject(this.map)&&"undefined"!=typeof google){var a=this.map.getCenter();google.maps.event.trigger(this.map,"resize"),this.map.setCenter(a),this.map.setZoom(12)}var b=this.$(".commentList");this.$(b).scrollTop(b[0].scrollHeight)},onRender:function(){this.model.get("new")&&this.model.save({"new":0},{silent:!0});var a=this.$(".commentList");this.$(a).scrollTop(a[0].scrollHeight)},render:function(){if(this.modelExists){var a=this.model.get("id"),b=this.model.get("authorName"),c=this.model.get("lastEditorName"),d=this.model.get("submitted"),e=this.model.get("updated"),f=this.model.get("ip"),g=this.model.get("sender"),h=this.model.get("data"),j=this.$("#showEmptyFields").is(":checked")?"checked":"",l=this.model.get("files"),m=this.model.get("comments");if(!_.isEmpty(l)){var n=_.keys(options.fileFields),o=[];n.forEach(function(s){var t=!1;l=l.filter(function(u){return t||u.field!=s||(o.push(u),t=!0,!1)})}),l=o.concat(l)}_.isObject(g)||(g=JSON.parse(g)),_.isObject(h)||(h=JSON.parse(h)),this.el.innerHTML=this.template({id:a,form_name:options.formName,data:h,files:l,comments:m,author:b,lastEditor:c,created_at:d,updated_at:e,sender:g,ip:f,showEmptyFields:j});var p=this;if(p.$(".table-detail").find("td[data-key*=\"selectlist\"], td[data-key*=\"checkbox\"]").each(function(s,t){p.$(t).text(function(u,v){return v.replace(/,/g,", ")})}),_.isNumber(g.latitude)&&_.isNumber(g.longitude)&&"undefined"!=typeof google){this.$el.find("#map").css({width:"100%",height:"300px"});var q=new google.maps.LatLng(g.latitude,g.longitude),r={center:q,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.$el.find("#map")[0],r),this.marker=new google.maps.Marker({position:q,map:this.map,title:"Sender Location"})}this.onRender()}return this}}),App.BulkView=Backbone.View.extend({tagName:"div",template:_.template($("#bulkTemplate").html()),onClose:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},render:function(){return this.el.innerHTML=this.template(),this}}),App.FormView=Backbone.View.extend({modelExists:!1,tagName:"div",template:_.template($("#formTemplate").html()),events:{"submit #form-app":"saveModel"},initialize:function(a){if(this.subtitle=a.subtitle,_.isObject(this.model))this.modelExists=!0;else if(!_.isUndefined(a.id)){var b=this;this.model=new Submission,this.model.id=a.id,this.model.url=function(){return options.hasPrettyUrls?options.endPoint+"/"+a.id:options.deleteEndPoint+"&id="+a.id},this.model.fetch({success:function(){b.modelExists=!0,b.render()}})}},saveModel:function(a){a.preventDefault();var b=$("[type=\"file\"]"),c={},d=_.map(options.fields,function(f){return f.name});if(_.each(d,function(f){var g=f.split("_",1),h=[];"selectlist"==g?($("select[name=\""+f+"[]\"] option:selected").each(function(){h.push(this.value)}),c[f]=h):"checkbox"==g?($("input[name=\""+f+"[]\"]:checked").each(function(){h.push(this.value)}),c[f]=h):"radio"==g?$("input[name=\""+f+"\"]:checked").each(function(){c[f]=this.value}):c[f]=$("#"+f).val()}),!_.isEmpty(c)||0<b.size()){var e=this;this.modelExists?(b.each(function(){var f=$(this).attr("name"),g=Backbone.Model.extend({url:options.uploadEndPoint+"&s_id="+e.model.get("id"),fileAttribute:f}),h=new g,j=$(this)[0].files[0];_.isUndefined(j)||($(window).off("beforeunload").on("beforeunload",function(){return options.i18n.uploadingFile}),h.set(f,j),h.save({},{success:function(l,m){var n=e.model.get("files");n.unshift(m);var o=_.uniq(n,function(p){return p.id});e.model.set("files",o)}}),h.on("progress",function(l){1==l&&$(window).off("beforeunload")}))}),this.model.save({data:c},{success:function(){App.Router.navigate("",{trigger:!0})},error:function(f,g){alert(g.statusText)}})):this.collection.create({form_id:options.formID,data:c},{wait:!0,error:function(f,g){alert(g.statusText)},success:function(f){b.each(function(){var g=$(this).attr("name"),h=Backbone.Model.extend({url:options.uploadEndPoint+"&s_id="+f.get("id"),fileAttribute:g}),j=new h,l=$(this)[0].files[0];"undefined"!=typeof l&&($(window).off("beforeunload").on("beforeunload",function(){return options.i18n.uploadingFile}),j.set(g,l),j.save({},{success:function(){e.collection.firstPage()}}),j.on("progress",function(m){1==m&&$(window).off("beforeunload")}))})}})}},onClose:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},render:function(){this.el.innerHTML=this.template({form_name:options.formName,subtitle:this.subtitle}),this.modelExists&&this.populateDataInForm();var a=this.$("[type=\"file\"]");return a.removeAttr("required"),a.parents(".form-group").removeClass("required-control"),this},populateDataInForm:function(){var a=this,b=a.model.get("data");_.isObject(b)||(b=JSON.parse(b));var c=_.map(options.fields,function(d){return d.name});return _.each(c,function(d){var e=d.split("_",1);if("selectlist"==e){var f=b[d];a.$("select[name=\""+d+"[]\"]").each(function(){$(this);_.each(f,function(j){a.$("select[name=\""+d+"[]\"] option[value=\""+j+"\"]").prop("selected",!0)})})}else if("checkbox"==e){var g=b[d];a.$("input[name=\""+d+"[]\"]").each(function(){var h=$(this);_.each(g,function(j){h.val()==j&&h.prop("checked",!0)})})}else"radio"==e?a.$("input[name=\""+d+"\"]").each(function(h,j){var l=$(j);l.val()==b[d]&&l.prop("checked",!0)}):a.$("#"+d).val(b[d])}),this}}),App.NavView=Backbone.View.extend({template:_.template($("#navTemplate").html()),page:"Submissions",initialize:function(a){this.page=a.page},onClose:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},render:function(){return this.el.innerHTML=this.template({page:this.page}),this}}),App.PaginationView=Backbone.View.extend({template:_.template($("#paginationTemplate").html()),initialize:function(){_.bindAll(this,"previous","next"),this.listenTo(this.collection,"sync:page",this.render)},events:{"click a.first":"first","click a.prev":"previous","click a.next":"next","click a.last":"last"},onClose:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},render:function(){return this.el.innerHTML=this.template(this.collection.getPage()),this},isDisabled:function(a){return this.$(a.currentTarget).parent().hasClass("disabled")},first:function(a){return a.preventDefault(),this.isDisabled(a)||this.collection.firstPage(),!1},previous:function(a){return a.preventDefault(),this.isDisabled(a)||this.collection.previousPage(),!1},next:function(a){return a.preventDefault(),this.isDisabled(a)||this.collection.nextPage(),!1},last:function(a){return a.preventDefault(),this.isDisabled(a)||this.collection.lastPage(),!1}});var Submission=Backbone.Model.extend({url:function(){var a=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"&id=")+encodeURIComponent(this.id)},methodUrl:function(a){if("delete"==a)return options.hasPrettyUrls?options.endPoint+"/"+this.attributes.id:options.deleteEndPoint+"&id="+this.attributes.id;return"update"==a?options.hasPrettyUrls?options.endPoint+"/"+this.attributes.id:options.updateEndPoint+"&id="+this.attributes.id:!("create"!=a)&&(options.hasPrettyUrls?options.endPoint+"/"+this.attributes.id:options.createEndPoint+"&id="+this.attributes.id)},sync:function(a,b,c){b.methodUrl&&b.methodUrl(a.toLowerCase())&&(c=c||{},c.url=b.methodUrl(a.toLowerCase())),Backbone.sync(a,b,c)},initialize:function(){}}),Submissions=Backbone.Collection.extend({url:options.endPoint,model:Submission,pager:{},sort_attribute:App.Options.sort_attribute,initialize:function(){_.bindAll(this,"parse","destroyModelsByIds","loadPager","getPage","reloadPage","showPage","firstPage","lastPage","nextPage","previousPage","searchPage"),options.hasPrettyUrls&&(this.model=Backbone.Model),this.pager.currentPage=1,this.keywords="",this.startDate="",this.endDate="",this.sort_attribute=App.Options.sort_attribute,this.listenTo(this,"destroy",this.onDestroy),this.listenTo(this,"sync",this.onSync)},onSync:function(a,b){if(!_.isObject(a.models))return!(b.updated_at>b.created_at)&&(_.isNull(b.new)||b.new)&&this.firstPage().then(function(){App.Router.navigate("",{trigger:!0})}),!1},onDestroy:function(){this.fetchPage()},parse:function(a){return this.pager=a._meta,a.items},updateModelsByIds:function(a,b){var c=this;$.ajax({url:options.updateAllEndPoint,type:"POST",data:{id:options.formID,ids:a,attributes:b}}).done(function(d){d.success&&0<d.itemsUpdated?c.reloadPage():alert(options.i18n.errorOnUpdate)}).fail(function(){alert(options.i18n.errorOnUpdate)})},destroyModelsByIds:function(a){var b=this;$.ajax({url:options.deleteAllEndPoint,type:"POST",data:{id:options.formID,ids:a}}).done(function(c){c.success&&0<c.itemsDeleted?b.pager.currentPage==b.pager.pageCount?b.previousPage():b.reloadPage():alert(options.i18n.errorOnDelete)}).fail(function(){alert(options.i18n.errorOnDelete)})},loadPager:function(){return this.pager.pageCount=Math.ceil(this.pager.totalCount/this.pager.perPage),this.pager.prev=!1,this.pager.next=!1,this.pager.range={min:this.pager.totalCount?(this.pager.currentPage-1)*this.pager.perPage+1:this.pager.totalCount,max:Math.min(this.pager.totalCount,this.pager.currentPage*this.pager.perPage)},1<this.pager.currentPage&&(this.pager.prev=this.pager.currentPage-1),this.pager.currentPage<this.pager.pageCount&&(this.pager.next=this.pager.currentPage+1),this},getPage:function(){return this.loadPager(),this.pager},reloadPage:function(){return this.fetchPage()},showPage:function(a){return this.pager.currentPage=a,this.fetchPage()},nextPage:function(){return++this.pager.currentPage,this.fetchPage()},previousPage:function(){return--this.pager.currentPage,this.fetchPage()},firstPage:function(){return this.pager.currentPage=1,this.fetchPage()},lastPage:function(){return this.pager.currentPage=this.pager.pageCount,this.fetchPage()},searchPage:function(a){return this.keywords=a,this.pager.currentPage=1,this.fetchPage()},filterPage:function(a,b){return this.startDate=a,this.endDate=b,this.pager.currentPage=1,this.fetchPage()},sortPage:function(a){return this.sort_attribute=a,App.Options.sort_attribute=a,App.set("form_"+options.formID+"_options",App.Options),this.pager.currentPage=1,this.fetchPage()},fetchPage:function(){var a=this;return this.fetch({data:$.param({id:options.formID,q:this.keywords,sort:this.sort_attribute,page:this.pager.currentPage,start:this.startDate,end:this.endDate}),reset:!0,success:function(){a.trigger("sync:page")}})}}),Router=Backbone.Router.extend({views:{},initialize:function(a){this.main=a.main,this.submissions=a.submissions,this.routesHit=0,Backbone.history.on("route",function(){this.routesHit++},this)},routes:{"":"index",back:"back",add:"add","edit/:id":"edit","view/:id":"view"},closeViews:function(){_.invoke(this.views,"close")},index:function(){this.closeViews(),this.views.navView=new App.NavView({page:options.i18n.index,collection:this.submissions}),this.main.html(this.views.navView.render().el),this.views.submissionsView=new App.SubmissionsView({collection:this.submissions}),this.main.append(this.views.submissionsView.render().el)},back:function(){1<this.routesHit?(this.routesHit-=2,window.history.back()):("/"!=Backbone.history.getFragment()&&(this.routesHit=0),this.navigate("",{trigger:!0,replace:!0}))},bulk:function(){this.closeViews(),this.views.navView=new App.NavView({page:options.i18n.bulkActions}),this.main.html(this.views.navView.render().el),this.views.bulkView=new App.BulkView,this.main.append(this.views.bulkView.render().el)},add:function(){this.closeViews(),this.views.navView=new App.NavView({page:options.i18n.addSubmission,collection:this.submissions}),this.main.html(this.views.navView.render().el),this.views.formView=new App.FormView({subtitle:options.i18n.addSubmission,collection:this.submissions}),this.main.append(this.views.formView.render().el)},edit:function(a){this.closeViews(),this.views.navView=new App.NavView({page:options.i18n.editSubmission,collection:this.submissions}),this.main.html(this.views.navView.render().el),this.views.formView=new App.FormView({id:a,subtitle:options.i18n.editSubmission,model:this.submissions.get(a)}),this.main.append(this.views.formView.render().el)},view:function(a){this.closeViews(),this.views.navView=new App.NavView({page:options.i18n.submissionDetails,collection:this.submissions}),this.main.html(this.views.navView.render().el),this.views.detailView=new App.DetailView({id:a,model:this.submissions.get(a)}),this.main.append(this.views.detailView.render().el),this.views.detailView.afterAppend()}});App.init=function(){var a=App.get("form_"+options.formID+"_options");return _.isEmpty(a)||(App.Options=a),App.Submissions=new Submissions,App.Submissions.fetchPage().then(function(){App.Router=new Router({main:$("#main"),submissions:App.Submissions}),Backbone.history.start()})},$(function(){App.init()});
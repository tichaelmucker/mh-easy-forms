jQuery(document).ready(function(){window.formEl=$(options.name);var e,t,s,o,r=$("#progress"),n=$("#bar"),a=$("#percent"),l=$("fieldset");function d(){Utils.postMessage({height:$("body").outerHeight(!0)})}formEl.attr("role","form"),$("<input>").attr({type:"hidden",id:"_csrf",name:"_csrf",value:options._csrf}).appendTo(formEl),options.autocomplete?formEl.attr("autocomplete","on"):formEl.attr("autocomplete","off"),options.novalidate?formEl.attr("novalidate","novalidate"):"novalidate"!==formEl.attr("novalidate")&&formEl.removeAttr("novalidate"),options.resume&&formEl.resume({key:"form_app_"+options.id}),jQuery(window).resize(function(){clearTimeout(o),o=setTimeout(d,50)}),jQuery(window).load(function(){if(Utils.postMessage({height:$("body").outerHeight(!0)}),"preview"===options.mode)return!1;options.defaultValues&&(options.defaultValues=JSON.parse(options.defaultValues),$.each(options.defaultValues,function(e,t){var s=e.split("_",1);"checkbox"==s||"radio"==s?$("#"+e).prop("checked",t):$("#"+e).val(t)})),formEl.trigger("view")});var p,f,c,u,m,g,h=!1,v=0;function w(){$(".error-block").remove(),$(".form-group").removeClass("has-error")}formEl.find(":input").each(function(){$(this).one("change",function(){if(!1===h){if("preview"===options.mode)return!1;v=(new Date).getTime(),formEl.trigger("fill")}h=!0})}),window.nextStep=function(o){o.preventDefault();var i=!1;if(t=$(o.currentTarget).parents("fieldset").next(),e=$(this).parents("fieldset"),options.skips.length>0)for(var r=0;r<options.skips.length;r++)if(l.index(e)<options.skips[r].to){var n=l.eq(options.skips[r].to);if(l.index(e)<l.index(n)){null!=options.skips[r].from&&options.skips[r].from!=l.index(e)||(options.skips[r].from=l.index(e),t=n);break}}t.is("fieldset")&&$.ajax({url:options.validationUrl,type:"post",data:formEl.serialize(),complete:function(e,t){},beforeSend:function(t,s){var o=e.find("input:file[required]");o.size()>0&&$.each(o,function(){$(this).val()&&(s.data=s.data+"&"+$(this).attr("name")+"=1")}),s.data=s.data+"&current_page="+l.index(e)},success:function(o){if(null!==o&&"object"==typeof o&&(e.find(".error-block").remove(),e.find(".form-group").removeClass("has-error"),$.each(o,function(t,s){var o=e.find("#"+t).parent(".form-group");if(o.size()>0){i=!0,o.addClass("has-error");var r=$("<div>",{class:"help-block error-block",html:s});o.append(r)}})),!i){e.hide();var r=$(".steps");if(r.size()>0)r.find(".step").eq(l.index(e)).removeClass("current"),r.find(".step").eq(l.index(t)).prevAll().addClass("success"),r.find(".step").eq(l.index(t)).addClass("current");else{var n=$(".progress").first().find(".progress-bar"),a=n.find(".percent"),d=n.find(".title"),p=n.data("titles");if(void 0!==p){var f=(p=p.split(","))[l.index(t)];d.html(f)}var c=Math.round(100/l.size()*l.index(t))+"%";a.text(c),n.width(c)}t.show(),s=e}formEl.trigger("nextStep"),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})},error:function(){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger"),formEl.hide(),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}})},window.previousStep=function(t){if(t.preventDefault(),s.is("fieldset")){e=$(this).parents("fieldset");for(var o=0;o<options.skips.length;o++)if(l.index(e)==options.skips[o].to){s=l.eq(options.skips[o].from);break}var i=$(".steps");if(i.size()>0)i.find(".step").removeClass("success"),i.find(".step").eq(l.index(e)).removeClass("current"),i.find(".step").eq(l.index(s)).prevAll().addClass("success"),i.find(".step").eq(l.index(s)).addClass("current");else{var r=$(".progress").first().find(".progress-bar"),n=r.find(".percent"),a=r.find(".title"),d=r.data("titles");if(void 0!==d){var p=(d=d.split(","))[l.index(s)];a.html(p)}var f=Math.round(100/l.size()*l.index(s))+"%";n.text(f),r.width(f)}e.hide(),s.show(),s=s.prev(),formEl.trigger("previousStep"),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}},$("input").on("keypress",function(e){if(13==e.keyCode){var t=$(e.currentTarget).parents("fieldset").find(".next");if(t.size()>0)return e.preventDefault(),t.click(),!1}}),$(".next").click(nextStep),$(".previous").click(previousStep),formEl.ajaxForm({url:options.actionUrl,type:"post",beforeSubmit:function(e,t,s){if("preview"===options.mode)return!1;var o=!1;if($.each(t.find('input[type="file"]'),function(e,t){$(t).val()&&(o=!0)}),o){r.show();n.css("width","0%"),a.html("0% "+options.i18n.complete),Utils.postMessage({height:$("body").outerHeight(!0)})}formEl.find(":submit").attr("disabled",!0)},uploadProgress:function(e,t,s,o){var i=o+"%";n.css("width",i),a.html(i+" "+options.i18n.complete)},success:function(e){e.success?(w(),formEl.find(":submit").attr("disabled",!1),formEl.resetForm(),r.hide(),function(e){options.submitted=!0;var t=(new Date).getTime()-v;if(formEl.trigger("success",[e,t]),l.size()>1){var s=$(".steps");if(s.size()>0)s.find(".step").addClass("success");else{var o=$(".progress").first(),i=o.find(".progress-bar"),r=i.find(".percent"),n=i.find(".title");n.html("Complete"),r.text("100%"),i.width("100%")}}void 0!==e.addon&&void 0!==e.addon.redirectTo&&Utils.postMessage({url:e.addon.redirectTo});if(options.confirmationType===options.redirectToUrl)Utils.postMessage({url:void 0===e.confirmationUrl?options.confirmationUrl:e.confirmationUrl});else{var a=options.confirmationMessage?options.confirmationMessage:e.message;Utils.hideMessage("#messages"),Utils.showMessage("#messages",a,"success"),options.confirmationType===options.showOnlyMessage&&formEl.hide(),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}}(e)):function(e){Utils.hideMessage("#messages"),void 0!==e.message&&Utils.showMessage("#messages",e.message,"danger");if(Utils.postMessage({scrollToTop:"container"}),w(),void 0!==e.errors&&e.errors.length>0){var t=e.errors;for(k=0;k<t.length;k++){var s=$("#"+t[k].field).parent(".form-group");for(s.addClass("has-error"),i=0;i<t[k].messages.length;i++){var o=$("<div>",{class:"help-block error-block",html:t[k].messages[i]});s.append(o)}}}formEl.find(":submit").removeAttr("disabled"),Utils.postMessage({height:$("body").outerHeight(!0)}),formEl.trigger("error",e)}(e)},error:function(e,t,s){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger"),formEl.hide(),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}}),options.analytics&&(p=window,f=document,c=options.tracker,p[u="tracker"]||(p.FA=p.FA||[],p.FA.push(u),p[u]=function(){(p[u].q=p[u].q||[]).push(arguments)},p[u].q=p[u].q||[],m=f.createElement("script"),g=f.getElementsByTagName("script")[0],m.async=1,m.src=c,g.parentNode.insertBefore(m,g)),window.tracker("newTracker","t"+options.id,options.app,{encodeBase64:!1,appId:options.id}),formEl.on("view",function(e){window.tracker("setCustomUrl",decodeURIComponent(Utils.getUrlVars().url)),window.tracker("setReferrerUrl",decodeURIComponent(Utils.getUrlVars().referrer)),window.tracker("trackPageView",decodeURIComponent(Utils.getUrlVars().title))}),formEl.on("fill",function(e){window.tracker("trackStructEvent","form","fill","start",null,null)}),formEl.on("error",function(e){window.tracker("trackStructEvent","form","error",null,null,null)}),formEl.on("success",function(e,t,s){window.tracker("trackStructEvent","form","submit",t.id,"time",s)}))});